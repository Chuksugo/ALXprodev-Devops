#!/bin/bash

input_dir="pokemon_data"
output_file="pokemon_report.csv"

echo "Name,Height (m),Weight (kg)" > "$output_file"

sum_height=0
sum_weight=0
count=0

for file in "$input_dir"/*.json; do
  name=$(jq -r '.name' "$file")
  height_dm=$(jq -r '.height' "$file")
  weight_hg=$(jq -r '.weight' "$file")

  height=$(echo "scale=2; $height_dm / 10" | bc)
  weight=$(echo "scale=2; $weight_hg / 10" | bc)

  # Capitalize first letter with sed
  capitalized_name=$(echo "$name" | sed 's/^\(.\)/\U\1/')

  echo "$capitalized_name,$height,$weight" >> "$output_file"

  sum_height=$(echo "$sum_height + $height" | bc)
  sum_weight=$(echo "$sum_weight + $weight" | bc)
  ((count++))
done

avg_height=$(awk "BEGIN {printf \"%.2f\", $sum_height/$count}")
avg_weight=$(awk "BEGIN {printf \"%.2f\", $sum_weight/$count}")

echo "CSV Report generated at: $output_file"
echo
cat "$output_file"
echo
echo "Average Height: $avg_height m"
echo "Average Weight: $avg_weight kg"
